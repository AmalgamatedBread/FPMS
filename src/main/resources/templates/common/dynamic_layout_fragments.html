<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <meta name="_csrf" th:content="${_csrf.token}"/>
    <meta name="_csrf_header" th:content="${_csrf.headerName}"/>
</head>
<body>

<!-- Dynamic Header Fragment -->
<header th:fragment="dynamicHeader">
    <nav class="navigation">
        <div class="header">
            <h3 class="nav-header" th:text="${pageTitle ?: 'FPMS Dashboard'}">FPMS Dashboard</h3>
        </div>

        <div class="search-bar">
            <input type="search" placeholder="Search...">
        </div>

        <div class="notif-profile" sec:authorize="isAuthenticated()">
            <a th:href="@{/notifications}" title="Notifications"
               th:class="${pageTitle == 'Notifications' ? 'active' : ''}">
                <img th:src="@{/icons/notification.png}" alt="Notifications" width="28" height="28">
            </a>
            <a th:href="@{/profile}" title="Profile"
               th:class="${pageTitle == 'Profile' ? 'active' : ''}">
                <img th:src="@{/icons/profile.png}" alt="Profile" width="28" height="28">
            </a>
            <span class="user-email" th:text="${#authentication.principal.username}"></span>
        </div>
    </nav>
</header>

<!-- Dynamic Sidebar Fragment - UNIFIED FOR ALL ROLES -->
<div th:fragment="dynamicSidebar">
    <div class="side-bar">
        <div class="top-section">
            <!-- Dashboard Links - Only show based on user's actual role -->
            <!-- FACULTY Dashboard Link -->
            <a th:href="@{/faculty-dashboard}" title="Dashboard" class="sidebar-link"
               th:class="${pageTitle == 'Faculty Dashboard' ? 'sidebar-link active' : 'sidebar-link'}"
               sec:authorize="hasAuthority('ROLE_FACULTY')">
                <img th:src="@{/icons/dashboard.png}" alt="Dashboard" width="28" height="28">
            </a>

            <!-- DEPARTMENT HEAD Dashboard Link -->
            <a th:href="@{/head-dashboard}" title="Dashboard" class="sidebar-link"
               th:class="${pageTitle == 'Head Dashboard' ? 'sidebar-link active' : 'sidebar-link'}"
               sec:authorize="hasAuthority('ROLE_DEPT_HEAD')">
                <img th:src="@{/icons/dashboard.png}" alt="Dashboard" width="28" height="28">
            </a>

            <!-- DEAN Dashboard Link -->
            <a th:href="@{/dean-dashboard}" title="Dashboard" class="sidebar-link"
               th:class="${pageTitle == 'Dean Dashboard' ? 'sidebar-link active' : 'sidebar-link'}"
               sec:authorize="hasAuthority('ROLE_DEAN')">
                <img th:src="@{/icons/dashboard.png}" alt="Dashboard" width="28" height="28">
            </a>

            <!-- ==================== UNIFIED PORTFOLIOS LINK ==================== -->
            <!-- ALL ROLES see "Portfolios" in sidebar -->
            <a th:href="@{/portfolio}" title="Portfolios" class="sidebar-link"
               th:class="${pageTitle == 'Portfolios' ? 'sidebar-link active' : 'sidebar-link'}"
               sec:authorize="isAuthenticated()">
                <img th:src="@{/icons/portfolios.png}" alt="Portfolios" width="28" height="28">
            </a>

            <!-- ========== SUBMISSIONS ONLY FOR FACULTY ========== -->
            <a th:href="@{/submissions}" title="My Submissions" class="sidebar-link"
               th:class="${pageTitle == 'My Submissions' ? 'sidebar-link active' : 'sidebar-link'}"
               sec:authorize="hasAuthority('ROLE_FACULTY')">
                <img th:src="@{/icons/approval.png}" alt="Submissions" width="28" height="28">
            </a>

            <!-- ========== APPROVAL QUEUE ONLY FOR HEADS/DEANS ========== -->
            <a th:href="@{/approval}" title="Approval Queue" class="sidebar-link"
               th:class="${pageTitle == 'Approval Queue' ? 'sidebar-link active' : 'sidebar-link'}"
               sec:authorize="hasAnyAuthority('ROLE_DEPT_HEAD', 'ROLE_DEAN')">
                <img th:src="@{/icons/approval.png}" alt="Approval" width="28" height="28">
            </a>

            <!-- Horizontal rule for separation -->
            <hr sec:authorize="hasAnyAuthority('ROLE_FACULTY', 'ROLE_DEPT_HEAD', 'ROLE_DEAN')">

            <!-- ========== FORWARD DOCUMENTS FOR ALL ROLES ========== -->
            <a th:href="@{/forward-docs}" title="Forward Documents" class="sidebar-link"
               th:class="${pageTitle == 'Forward Documents' ? 'sidebar-link active' : 'sidebar-link'}"
               sec:authorize="hasAnyAuthority('ROLE_FACULTY', 'ROLE_DEPT_HEAD', 'ROLE_DEAN')">
                <img th:src="@{/icons/Forward.png}" alt="Forward" width="28" height="28">
            </a>

            <!-- ========== DEPARTMENT LINK FOR ALL ROLES ========== -->
            <a th:href="@{/department}" title="Department" class="sidebar-link"
               th:class="${pageTitle == 'Department' ? 'sidebar-link active' : 'sidebar-link'}"
               sec:authorize="hasAnyAuthority('ROLE_FACULTY', 'ROLE_DEPT_HEAD', 'ROLE_DEAN')">
                <img th:src="@{/icons/members.png}" alt="Department" width="28" height="28">
            </a>
        </div>

        <div class="bottom-section">
            <!-- Common links for all roles -->
            <a th:href="@{/bin}" title="Bin" class="sidebar-link"
               th:class="${pageTitle == 'Bin' ? 'sidebar-link active' : 'sidebar-link'}"
               sec:authorize="isAuthenticated()">
                <img th:src="@{/icons/Bin.png}" alt="Bin" width="28" height="28">
            </a>

            <a th:href="@{/settings}" title="Settings" class="sidebar-link"
               th:class="${pageTitle == 'Settings' ? 'sidebar-link active' : 'sidebar-link'}"
               sec:authorize="isAuthenticated()">
                <img th:src="@{/icons/settings.png}" alt="Settings" width="28" height="28">
            </a>

            <!-- Logout link -->
            <a th:href="@{/logout}" title="Logout" class="sidebar-link"
               sec:authorize="isAuthenticated()">
                <img th:src="@{/icons/logout.png}" alt="Logout" width="28" height="28">
            </a>
        </div>
    </div>
</div>

</body>
</html>